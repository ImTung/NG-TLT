machine:
  node:
    version: 6.9.5

dependencies:
  pre:
    - 'echo "//registry.npmjs.org/:_authToken=f7b8ae4f-95ce-496e-8e82-c5183ed071dc" > ~/.npmrc'
test:
  override:
    - rm -rf $CIRCLE_ARTIFACTS/coverage
    - npm run lint
    - npm run test
    - cp -r coverage $CIRCLE_ARTIFACTS
    - node node_modules/coveralls/bin/coveralls.js < coverage/coverage.lcov

compile:
  override:
    - npm run buildlib

deployment:
  feature:
    branch: master
    commands:
      - ./config/npm-deploy-feature.sh
  production:
    tag: /(v)?[0-9]+(\.[0-9]+)*/
    commands:
      - ./config/npm-deploy.sh
